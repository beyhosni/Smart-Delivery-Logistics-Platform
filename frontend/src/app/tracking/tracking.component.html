<div class="tracking-container">
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <div *ngIf="delivery && !loading" class="row">
    <!-- Carte de suivi -->
    <div class="col-lg-8 mb-4">
      <div class="card shadow">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
          <h6 class="m-0 font-weight-bold text-primary">Suivi en temps réel</h6>
          <span class="badge {{ getStatusBadgeClass(delivery.status) }}">
            {{ getStatusText(delivery.status) }}
          </span>
        </div>
        <div class="card-body p-0">
          <div class="map-container" style="height: 400px; background-color: #f8f9fc; border-radius: 0.25rem; display: flex; align-items: center; justify-content: center;">
            <div *ngIf="!currentLocation" class="text-center">
              <i class="fas fa-map-marked-alt fa-3x text-muted mb-2"></i>
              <p class="text-muted">Position non disponible</p>
            </div>
            <div *ngIf="currentLocation" class="text-center">
              <i class="fas fa-map-marker-alt fa-3x text-primary mb-2"></i>
              <p>Position actuelle</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Événements de suivi -->
    <div class="col-lg-4 mb-4">
      <div class="card shadow">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Événements de suivi</h6>
        </div>
        <div class="card-body">
          <div class="timeline">
            <div class="timeline-item" *ngFor="let event of trackingEvents; let last = last">
              <div class="timeline-marker">
                <i class="{{ getEventIcon(event.eventType) }} {{ getEventIconClass(event.eventType) }}"></i>
              </div>
              <div class="timeline-content">
                <div class="timeline-time">{{ event.timestamp | date:'short' }}</div>
                <div class="timeline-title">{{ event.description }}</div>
                <div *ngIf="event.courierName" class="timeline-subtitle">Livreur: {{ event.courierName }}</div>
                <div *ngIf="event.recipientName" class="timeline-subtitle">Destinataire: {{ event.recipientName }}</div>
              </div>
              <div *ngIf="!last" class="timeline-line"></div>
            </div>
          </div>

          <div *ngIf="estimatedDeliveryTime && delivery.status !== 'DELIVERED'" class="mt-3 p-3 bg-light rounded">
            <h6 class="text-primary">Estimation de livraison</h6>
            <p class="mb-0">{{ estimatedDeliveryTime | date:'full' }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Informations sur la livraison -->
  <div *ngIf="delivery && !loading" class="row mt-4">
    <div class="col-12">
      <div class="card shadow">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Informations sur la livraison</h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <h6 class="text-muted">Adresse de ramassage</h6>
              <div class="card bg-light">
                <div class="card-body">
                  <p class="mb-1"><strong>{{ delivery.pickupAddress.street }}</strong></p>
                  <p class="mb-1">{{ delivery.pickupAddress.postalCode }} {{ delivery.pickupAddress.city }}</p>
                  <p class="mb-0">{{ delivery.pickupAddress.country }}</p>
                </div>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <h6 class="text-muted">Adresse de livraison</h6>
              <div class="card bg-light">
                <div class="card-body">
                  <p class="mb-1"><strong>{{ delivery.deliveryAddress.street }}</strong></p>
                  <p class="mb-1">{{ delivery.deliveryAddress.postalCode }} {{ delivery.deliveryAddress.city }}</p>
                  <p class="mb-0">{{ delivery.deliveryAddress.country }}</p>
                </div>
              </div>
            </div>
          </div>

          <div class="row mt-3">
            <div class="col-md-6">
              <h6 class="text-muted">Détails du colis</h6>
              <div class="card bg-light">
                <div class="card-body">
                  <p class="mb-1"><strong>Poids:</strong> {{ delivery.packageDetails.weight }} kg</p>
                  <p class="mb-1"><strong>Dimensions:</strong> {{ delivery.packageDetails.dimensions.length }}x{{ delivery.packageDetails.dimensions.width }}x{{ delivery.packageDetails.dimensions.height }} cm</p>
                  <p class="mb-1"><strong>Fragile:</strong> {{ delivery.packageDetails.fragile ? 'Oui' : 'Non' }}</p>
                  <p *ngIf="delivery.packageDetails.description" class="mb-0"><strong>Description:</strong> {{ delivery.packageDetails.description }}</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <h6 class="text-muted">Destinataire</h6>
              <div class="card bg-light">
                <div class="card-body">
                  <p class="mb-1"><strong>Nom:</strong> {{ delivery.recipientName }}</p>
                  <p class="mb-1"><strong>Téléphone:</strong> {{ delivery.recipientPhone }}</p>
                  <p class="mb-0"><strong>Email:</strong> {{ delivery.recipientEmail }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div *ngIf="delivery && !loading" class="row mt-4">
    <div class="col-12 text-center">
      <button type="button" class="btn btn-outline-secondary" (click)="goBack()">
        <i class="fas fa-arrow-left me-1"></i> Retour à la liste
      </button>
    </div>
  </div>
</div>
